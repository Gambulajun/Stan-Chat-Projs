<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Scheduling Assistant</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Banner -->
    <div class="banner">
        <div class="container-fluid">
            <div class="d-flex align-items-center justify-content-center">
                <!-- Left Side: Logo -->
                <div class="logo-container mr-auto">
                    <img src="{{ url_for('static', filename='ai_image.svg') }}" alt="Standard Chartered Logo" class="logo" style="width:auto; height:auto; margin-left: 20px;">
                    <img src="{{ url_for('static', filename='analytics.svg') }}" alt="Standard Chartered Logo" class="logo" style="width:auto; height:auto; margin-left: 20px;">
                </div>
                <!-- Center: Title with Calendar Icon -->
                <div class="title-container text-center">
                    <h1 class="banner-title">
                        <i class="fas fa-calendar-alt"></i> Smart Scheduling Assistant Tool
                    </h1>
                </div>
                <!-- Right Side: Logout Button -->
                <div class="logout-container ml-auto">
                    {% if session.get('username') %}
                    <span class="text-white mr-2">Welcome, {{ session['username'] }}</span>
                    <a href="{{ url_for('logout') }}" class="btn btn-outline-light">Logout</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row no-gutters">
            {% if 'login' not in request.path %}
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-2 d-none d-md-block sidebar">
                <div class="sidebar-sticky">
                    <h5 class="mt-4">Select Audit</h5>
                    <input type="text" id="searchInput" class="form-control mb-2" placeholder="Search Audit">
                    <button id="searchButton" class="btn btn-primary mb-2">Search</button>
                    <select id="auditSelect" class="form-control">
                        {% for audit in audits %}
                        
                        <option value="{{ audit['audit_number'] }}" {% if audit['audit_number'] == audit_number %}selected{% endif %}>
                            {{ audit['audit_number'] }} - {{ audit['audit_title'] }}
                        </option>
                        
                        {% endfor %}
                    </select>
                </div>
            </nav>
            {% endif %}
            <!-- Main Content Area -->
            <main role="main" class="{% if 'login' not in request.path %}with-sidebar{% else %}without-sidebar{% endif %}">
                {% block main_content %}
                {% endblock %}
            </main>
        </div>
    </div>

    <!--<script>
        // Store original audits for search reset
    var originalOptions = [];
    document.addEventListener('DOMContentLoaded', function() {
    var select = document.getElementById('auditSelect');
    for (var i = 0; i < select.options.length; i++) {
        originalOptions.push({
            value: select.options[i].value,
            text: select.options[i].text,
            selected: select.options[i].selected
           });
         }
     });

        document.getElementById('searchButton').addEventListener('click', function() {
            var input = document.getElementById('searchInput').value.toLowerCase();
            var select = document.getElementById('auditSelect');
            
            //new line of code below:
            select.innerHTML = ''; // Clear all options
            
            // old line of code below:
            //  var options = select.getElementsByTagName('option');

            /*for (var i = 0; i < options.length; i++) {
                var optionText = options[i].text.toLowerCase();
                if (optionText.includes(input)) {
                    options[i].style.display = '';
                } else {
                    options[i].style.display = 'none';
                }
            }
        });*/

        originalOptions.forEach(function(opt) {
        if (opt.text.toLowerCase().includes(input)) {
            var option = document.createElement('option');
            option.value = opt.value;
            option.text = opt.text;
            if (opt.selected) option.selected = true;
            select.appendChild(option);
        }
     });
    });
    </script>-->


<!--<script>
    // Store the original dropdown options for resetting after search
    var originalOptions = [];
    document.addEventListener('DOMContentLoaded', function() {
        var select = document.getElementById('auditSelect');
        // Save all initial options
        for (var i = 0; i < select.options.length; i++) {
            originalOptions.push({
                value: select.options[i].value,
                text: select.options[i].text,
                selected: select.options[i].selected
            });
        }

        // Search button click event
        document.getElementById('searchButton').addEventListener('click', function() {
            var input = document.getElementById('searchInput').value.toLowerCase();
            var select = document.getElementById('auditSelect');
            select.innerHTML = ''; // Clear all options before filtering

            var found = false; // Track if any results are found
            // Add only matching options
            originalOptions.forEach(function(opt) {
                if (opt.text.toLowerCase().includes(input)) {
                    var option = document.createElement('option');
                    option.value = opt.value;
                    option.text = opt.text;
                    if (opt.selected) option.selected = true;
                    select.appendChild(option);
                    found = true;
                }
            });

            // If no results, show a disabled "No results found" option
            if (!found) {
                var option = document.createElement('option');
                option.text = 'No results found';
                option.disabled = true;
                select.appendChild(option);
            }
        });

        // Reset dropdown when search box is cleared
        document.getElementById('searchInput').addEventListener('input', function() {
            if (this.value === '') {
                var select = document.getElementById('auditSelect');
                select.innerHTML = ''; // Clear all options
                // Restore all original options
                originalOptions.forEach(function(opt) {
                    var option = document.createElement('option');
                    option.value = opt.value;
                    option.text = opt.text;
                    if (opt.selected) option.selected = true;
                    select.appendChild(option);
                });
            }
        });
    });
</script>-->
    
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var select = document.getElementById('auditSelect');
        var searchInput = document.getElementById('searchInput');
        var searchButton = document.getElementById('searchButton');
        var audits = [];
        var noResultMsg = document.createElement('div');
        noResultMsg.id = 'noResultMsg';
        noResultMsg.className = 'text-danger mt-2';
        noResultMsg.style.display = 'none';
        noResultMsg.innerText = 'No audit found';
        select.parentNode.appendChild(noResultMsg);

        // Store original audits for reset
        for (var i = 0; i < select.options.length; i++) {
            audits.push({
                value: select.options[i].value,
                text: select.options[i].text,
                selected: select.options[i].selected
            });
        }

        // Restore dropdown options
        function restoreOptions() {
            select.innerHTML = '';
            audits.forEach(function(opt) {
                var option = document.createElement('option');
                option.value = opt.value;
                option.text = opt.text;
                if (opt.selected) option.selected = true;
                select.appendChild(option);
            });
            noResultMsg.style.display = 'none';
        }

        // Dropdown change event (redirect)
        select.onchange = function() {
            var selectedAudit = this.value;
            window.location.href = "{{ url_for('view_resources', audit_number='') }}" + selectedAudit;
        };

        // Search button click event
        searchButton.addEventListener('click', function() {
            var input = searchInput.value.trim().toLowerCase();
            if (!input) {
                restoreOptions();
                return;
            }
            var found = false;
            for (var i = 0; i < audits.length; i++) {
                if (audits[i].text.toLowerCase().includes(input)) {
                    select.value = audits[i].value;
                    found = true;
                    // Trigger change event to redirect
                    select.dispatchEvent(new Event('change'));
                    noResultMsg.style.display = 'none';
                    break;
                }
            }
            if (!found) {
                noResultMsg.style.display = 'block';
            }
        });

        // Reset message and dropdown when typing
        searchInput.addEventListener('input', function() {
            if (this.value === '') {
                restoreOptions();
            }
            noResultMsg.style.display = 'none';
        });
    });
</script>

    <!-- jQuery and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    {% if 'login' not in request.path %}
    <script>
        // Handle audit selection change
        document.getElementById('auditSelect').addEventListener('change', function() {
            var selectedAudit = this.value;
            window.location.href = "{{ url_for('view_resources', audit_number='') }}" + selectedAudit;
        });
    </script>
    {% endif %}
</body>
</html>
